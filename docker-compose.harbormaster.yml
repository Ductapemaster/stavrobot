services:
  postgres:
    environment:
      POSTGRES_DB: ${POSTGRES_DB:-stavrobot}
      POSTGRES_USER: ${POSTGRES_USER:-stavrobot}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-stavrobot}
    volumes:
      - {{ HM_DATA_DIR }}/postgres:/var/lib/postgresql/data
  app:
    environment:
      PGHOST: postgres
      PGPORT: 5432
      PGUSER: ${POSTGRES_USER:-stavrobot}
      PGPASSWORD: ${POSTGRES_PASSWORD:-stavrobot}
      PGDATABASE: ${POSTGRES_DB:-stavrobot}
    volumes:
      - {{ HM_DATA_DIR }}/main/config.toml:/app/config.toml
      - {{ HM_DATA_DIR }}/app:/app/data
  python-runner: {}
  plugin-runner:
    volumes:
      - {{ HM_DATA_DIR }}/main:/config
      - {{ HM_DATA_DIR }}/plugins:/plugins
      - {{ HM_CACHE_DIR }}/plugins:/cache
  coder:
    volumes:
      - {{ HM_DATA_DIR }}/main:/config
      - {{ HM_DATA_DIR }}/coder:/home/coder/.claude
      - {{ HM_DATA_DIR }}/plugins:/plugins
      - {{ HM_CACHE_DIR }}/plugins:/cache
  pg-backup:
    volumes:
      - ./scripts:/scripts:ro
      - {{ HM_DATA_DIR }}/db-backups:/backups
  signal-bridge:
    profiles: ["signal"]
    volumes:
      - {{ HM_DATA_DIR }}/main/config.toml:/app/config.toml:ro
      - {{ HM_DATA_DIR }}/signal-cli:/root/.local/share/signal-cli
